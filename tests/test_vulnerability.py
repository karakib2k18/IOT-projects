import pandas as pd
from pathlib import Path
root = Path(__file__).resolve().parents[1]

summary_path = root / "results" / "summary_vulnerable.csv"
if not summary_path.exists():
    raise SystemExit(f"Error: summary file not found: {summary_path}")

s = pd.read_csv(summary_path).iloc[0]

# Acceptance thresholds for a vulnerable baseline
CONF_THRESHOLD = 10.0      # confidentiality percent <= 10%
INTERCEPT_RATIO = 0.9      # intercepted >= 90% of messages

conf_ok = s["confidentiality_pct"] <= CONF_THRESHOLD
intercept_ok = s["intercepted"] >= INTERCEPT_RATIO * s["total_msgs"]

print("Summary loaded:", summary_path)
print(f"Confidentiality pct: {s['confidentiality_pct']} (<= {CONF_THRESHOLD} ?) -> {conf_ok}")
print(f"Intercepted: {s['intercepted']} / {s['total_msgs']} (>= {int(INTERCEPT_RATIO*100)}% ?) -> {intercept_ok}")

if not (conf_ok and intercept_ok):
    raise SystemExit("Vulnerability test FAILED: baseline not sufficiently vulnerable.")
print("âœ… Vulnerability checks passed.")
